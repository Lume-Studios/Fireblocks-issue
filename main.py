from dotenv import load_dotenv
from mpc import MPCService
from os import getenv
from web3 import Web3

load_dotenv()

FIREBLOCKS_API_SECRET = getenv("FIREBLOCKS_API_SECRET")
FIREBLOCKS_API_KEY = getenv("FIREBLOCKS_API_KEY")
RPC_URL = getenv("RPC_URL")

MPC_SERVICE_NAME = "fireblocks"
CLIENT_ID = "e94aecb1-5daf-47f3-948f-2a639a56baa6"
FIREBLOCKS_BASE_URL = "https://api.fireblocks.io"
FIREBLOCKS_ASSET_ID = "ETH_TEST5"  # sepolia


transaction = {
    "value": 0,
    "maxFeePerGas": 183154603097,
    "maxPriorityFeePerGas": 3,
    "chainId": 11155111,  # sepolia
    "from": "0x87DE9dC28F4F2731647BAde25BF71acAE31c2A9A",
    "nonce": 0,
    "gas": 1965958,
    "to": "0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789",
    "data": "0x1fad948c000000000000000000000000000000000000000000000000000000000000004000000000000000000000000087de9dc28f4f2731647bade25bf71acae31c2a9a000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000004e011c950c634a665b6d0be363b6f90f39abe8c40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000009c17400000000000000000000000000000000000000000000000000000000000bfbc700000000000000000000000000000000000000000000000000000000000052080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000000584ccede7271d09808b074336c47d10585b99aeed9114c63b13a3d200e2c0fc38bb699650e4d36628a861f594427ac2c4b747977dbd2d39ac500000000000000000000000087de9dc28f4f2731647bade25bf71acae31c2a9a0000000000000000000000000000000000000000000000000000000000000000000000000000018447e1da2a000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000b72f28d9c0f72d488813e57581c17c466855e1f700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000024a0712d68000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004133f6a3bdf01a07175a279cf01fcb75fbc7e0b43910c2300ea09448e1cb777a9d324270598dbe990d648115831c4348300cbff66d63d5d5e4d49756748d98904f1b00000000000000000000000000000000000000000000000000000000000000",
}

mpc = MPCService(
    MPC_SERVICE_NAME,
    CLIENT_ID,
    {
        "base_url": FIREBLOCKS_BASE_URL,
        "api_key": FIREBLOCKS_API_KEY,
        "api_secret": FIREBLOCKS_API_SECRET,
    },
    fireblocks_asset_id=FIREBLOCKS_ASSET_ID,
)

mpc.sign_transaction(transaction)
raw_transaction = mpc.get_raw_tranaction()
print(raw_transaction)

# what we want from here is to send the raw transaction to the blockchain
w3 = Web3(Web3.HTTPProvider(RPC_URL))
tx_hash = w3.eth.send_raw_transaction(raw_transaction)
receipt = w3.eth.wait_for_transaction_receipt(tx_hash)
print(receipt)
